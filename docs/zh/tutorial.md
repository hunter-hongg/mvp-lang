# Miva 教程

## 前置要求

- ✅ 请先阅读 [快速开始](./quick-start.md)
- ✅ 请确保 `miva` 命令可用（可通过 `miva --version` 验证）

---

## 查看项目文件

初始化项目后，打开 `src/main.miva` 文件，你将看到以下内容：

```miva
// main.miva
// Generated by Miva init
module "main"

main = () => {
  println("Hello, World")
}
```

### 代码解析

| 行号 | 代码 | 说明 |
|------|------|------|
| 1-2 | `// ...` | 行注释，用法**与 C 语言相同** |
| 3 | `module "main"` | 模块声明，表示当前模块名称为 `main` |
| 4 | *空行* | 推荐在声明后保留空行，提高可读性 |
| 5-7 | `main = () => {...}` | 主函数定义 |

### 关键概念

> 🔑 **主模块**：`main` 是**特殊的模块名称**，表示当前模块为程序的入口模块。
>
> 🔑 **主函数**：`main` 函数是**Miva 程序的入口点**，程序从此处开始执行。
>
> 🔑 **函数语法**：Miva 中函数定义格式为：
> ```miva
> function_name = (parameters) => { function_body }
> ```
>
> 🔑 **内置函数**：`println` 是 Miva 的**内置函数**，无需导入且无法被覆盖。
>
> 🔑 **函数参数**：函数参数**必须用括号括起来**，多个参数之间用逗号隔开。
>
> 🔑 **注释**：Miva 注释风格与 C 相同，支持**行注释** (`//`) 与**块注释** (`/* */`)。
>
> 🔑 **语句**：Miva 中的语句**自动分隔，无需分号**；解析器**遇到分号会报错**。

---

## 定义变量

### 基本语法

```miva
// 不可变变量（默认）
variable_name := value

// 可变变量（需显式声明）
mut variable_name := value
```

### 核心规则

| 规则 | 说明 | 示例 |
|------|------|------|
| **默认不可变** | 变量定义后不可重新赋值 | `x := 5` |
| **可变需声明** | 使用 `mut` 关键字声明可变变量 | `mut y := 5` |
| **赋值用 `=`** | 可变变量使用 `=` 进行重新赋值 | `y = 10` |
| **必须初始化** | 不允许定义变量但不初始化 | ❌ `mut x;` |
| **类型推断** | 暂不支持手动标注类型 | ❌ `x: int := 5` |

### 示例

```miva
// 不可变变量
pi := 3.14159
// pi = 3.14  // ❌ 错误：不可重新赋值

// 可变变量
mut counter := 0
counter = 1      // ✅ 正确
counter = 2      // ✅ 正确
```

---

## 输出变量

### 打印函数

> ⚠️ **注意**：Miva 中**不能直接使用 `print` 或 `println` 输出变量**，请使用以下函数：

| 函数 | 说明 | 示例 |
|------|------|------|
| `prints(...)` | 依次输出参数，**不换行** | `prints("x = ", x)` |
| `printlns(...)` | 依次输出参数，**末尾换行** | `printlns("x = ", x)` |

### 参数规则

- 参数可以是任何**内置类型**（未来将支持用户自定义类型）
- 多个参数会**依次拼接输出**

### 示例

```miva
a := 5
b := 10

prints("a = ", a)           // 输出: a = 5（不换行）
printlns("b = ", b)         // 输出: b = 10（换行）

printlns("a + b = ", a + b) // 输出: a + b = 15
```

### 输出对比

```miva
// 使用 prints
prints("Hello, ")
prints("World!")
// 输出: Hello, World!

// 使用 printlns
printlns("Hello, ")
printlns("World!")
// 输出:
// Hello, 
// World!
```

---

## 类型

### 内置类型

Miva 提供以下内置类型：

| 类型 | 说明 |
|------|------|
| `int` | 64 位**平台无关**整数 |
| `bool` | 布尔值，`true` 或 `false` |
| `float` | 64 位**平台无关**浮点数 |
| `char` | 单个**字符** |
| `string` | 字符串，**自动管理内存** |
| `[type]` | 数组，**元素类型为 `type`** |

### 类型转换

Miva 的类型转换通过 `as` 关键字实现：

```miva
x := 5 as float    // 整数转浮点数
y := 5.5 as int    // 浮点数转整数（自动截断）
```

---

## 条件控制

### `if` 语法

Miva 提供 `if` 和 `else` 关键字实现**条件控制**：

```miva
if (condition) /* 括号不可省略 */ {
  ...
} else { 
  ...
}
```

> ⚠️ **注意**：Miva 暂不支持**多分支 `else if`**，v0.0.5 版本将引入 `elif` 关键字。

### `choose` 语法

Miva 提供**类似 `switch` 的 `choose` 语句**，用于多分支条件控制：

```miva 
choose (some_var) {
  when (value1) {
    ...
  }
  when (value2) {
    ...
  }
  ...
  otherwise { // 默认分支不可省略
    ...
  }
}
```

> 🔮 **未来计划**：Miva 将添加**穷尽性检查**，确保所有可能情况都被处理。

---

## 移动与复制

### `move` 原语

Miva 提供 `move` 原语，用于**移动数据所有权**：

```miva
y := move x 
```

- 移动后，**原变量不可访问**
- 在 `if` 或 `choose` 块中 `move` 的变量，**块结束后不可使用**

### `clone` 原语

Miva 提供 `clone` 原语，用于**复制数据**：

```miva
y := clone x 
```

- 复制后，**原变量仍可访问**

### 自动复制

Miva 对 **Copy 类型** 允许使用 `x := y` 语法进行**自动复制**：

**Copy 类型判定规则**：
- 基础类型（`int`、`bool`、`float`、`char`）均为 Copy 类型
- 对于 `struct`，如果所有字段都是 **Copy 类型**，则该结构体为 Copy 类型

---

## 函数

### 定义函数

Miva 函数定义语法如下：

```miva
function_name = (parameters) => {
  ...
}
```

- ❌ Miva **不支持函数重载**
- ✅ 函数自动返回**最后一个表达式**，或使用 `return expr` 显式返回

### 函数参数

Miva 函数参数分为两种：`own` 和 `ref`

| 参数类型 | 说明 | 调用方式 |
|----------|------|----------|
| `own` | 需要所有权 | 调用时需 `move` 或 `clone` |
| `ref` | 只读视图 | 直接传递，只可读不可修改 |

**参数声明语法**：

```miva
ref x: T    // ref 参数
own y: T    // own 参数
z: T        // 默认是 own 参数
```

多个参数之间用 `,` 分隔。